<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?php echo $topic->getTitle(); ?></title>
    <link rel="stylesheet" href="public/style.css">
</head>

<body>
    <a href="index.php">← Volver al Foro</a> |
    <a href="index.php?c=user&profile=1">Ver Perfil</a> |
    <a href="index.php?c=user&logout=1">Cerrar Sesión</a>

    <?php
    if (!$topic) {
        echo "<h1>❌ Topic no encontrado</h1>";
        echo "<p>El topic que buscas no existe o ha sido eliminado.</p>";
    } else {
        echo "<h1>📝 " . $topic->getTitle() . "</h1>";
        echo "<div class='topic-content'>";
        echo "<p>" . $topic->getDescription() . "</p>";
        echo "<small>Escrito por: <strong>" . $topic->getIdAuthor()->getUsername() . "</strong> el <strong>" . $topic->getDate() . "</strong></small>";
        echo "</div>";
        echo "<br>";

    ?>
        <h2>💬 Comentar</h2>
        <form method="POST" action="index.php?c=comment&id=<?php echo $_GET['id']; ?>">
            <textarea name="content" placeholder="Escribe tu comentario aquí..." required></textarea>
            <input type="submit" value="Enviar comentario" name="addComment">
        </form>

        <h2>💬 Comentarios</h2>
    <?php
        if (empty($comments)) {
            echo "<p>No hay comentarios aún. ¡Sé el primero en comentar!</p>";
        } else {
            foreach ($comments as $comment) {
                echo "<div class='comment-item'>";
                if ($_SESSION["user"]->getRol() || $comment->getIdAuthor()->getId() == $_SESSION["user"]->getId()) {
                    echo "<a href='index.php?c=comment&delete=" . $comment->getId() . "&post_id=" . $topic->getId() . "' class='delete-comment'>🗑️</a> ";
                }
                echo "<img src=public/img/" . $comment->getIdAuthor()->getAvatar() . " alt='Avatar' width='50px'><strong>" . $comment->getIdAuthor()->getUsername() . "</strong> - <small>" . $comment->getDate() . "</small><br>";
                echo "<p>" . $comment->getContent() . "</p>";
                echo "</div><br>";
            }
        }
    }
    ?>

</body>

</html>